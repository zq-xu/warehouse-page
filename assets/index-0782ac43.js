import{_ as E,a as h,s as z,b as M}from"./index.vue_vue_type_script_setup_true_lang-c0bb831c.js";import{d as k,c as $,g as N,h as C,o as D,b as O,w as n,f as e,aU as s,aT as u,u as y,bc as U,aW as W,q as P,aX as X,a as G,F as H,as as B,bf as K,be as Q,db as Y,bu as Z,j as ee,bv as te}from"./index-8daa1557.js";import{d as ae}from"./SearchableSelect.vue_vue_type_script_setup_true_lang-92c79cec.js";import{C as ne}from"./difference-5f2164a9.js";import{s as S}from"./supplier-1c31abf0.js";import{_ as oe}from"./ListTable.vue_vue_type_script_setup_true_lang-44a63c9e.js";import{_ as T,a as I}from"./DescriptionsItem-87ac5814.js";import{N as L}from"./text-5e02abb0.js";import{N as J}from"./Space-40c3b44e.js";import{_ as le}from"./Tag-656ba6f9.js";import{_ as se,a as re}from"./Tabs-51cde282.js";import"./Input-b5609ef7.js";import"./Suffix-cff3ef6f.js";import"./use-merged-state-3569f73f.js";import"./InputNumber-d9da7e3d.js";import"./Add-ddf47f49.js";import"./Select-ec81b3d5.js";import"./use-compitable-aee246b5.js";import"./cssr-b450591b.js";import"./Popover-62d545d9.js";import"./get-d43742d2.js";import"./format-length-c9d165c6.js";import"./next-frame-once-7035a838.js";import"./Switch-3a154844.js";import"./Checkbox-b9b1a3a5.js";import"./DataTable-9a0c077d.js";import"./Dropdown-6227f8d6.js";import"./Popconfirm-4d81e7e4.js";import"./crud-c9b4981a.js";import"./vuedraggable.umd-02d54b02.js";import"./refresh-9639090c.js";import"./useLoading-923511a2.js";const A={1:{label:"正常",type:"success"},2:{label:"异常",type:"error"},3:{label:"已删除",type:"default"}},ue=[{label:"名称",value:"name"},{label:"联系方式",value:"phone"},{label:"常用地址",value:"address"},{label:"创建时间",value:"createdAt"},{label:"更新时间",value:"updatedAt"},{label:"备注信息",value:"comment"}],pe=k({__name:"ProductLotDetail",props:{visible:{type:Boolean},productLot:null},emits:["update:visible","updateSucceed"],setup(p,{emit:i}){const d=p,w=$({get(){return d.visible},set(c){i("update:visible",c)}}),a=N(d.productLot);return C(()=>d.productLot,c=>{c&&(a.value=JSON.parse(JSON.stringify(d.productLot)))}),(c,v)=>{const r=T,m=I,f=W;return D(),O(f,{show:y(w),"onUpdate:show":v[0]||(v[0]=t=>U(w)?w.value=t:null),preset:"card",title:"商品批次",class:"w-600px"},{default:n(()=>[e(m,{columns:2,"label-placement":"left",class:"text-center",bordered:""},{default:n(()=>[e(r,{span:2,label:"名称"},{default:n(()=>{var t;return[s(u((t=a.value.product)==null?void 0:t.name),1)]}),_:1}),e(r,{span:2,label:"批次号"},{default:n(()=>[s(u(a.value.lotNo),1)]),_:1}),e(r,{span:2,label:"数量"},{default:n(()=>[s(u(a.value.count),1)]),_:1}),e(r,{span:2,label:"创建时间"},{default:n(()=>[s(u(a.value.createdAt),1)]),_:1}),e(r,{span:2,label:"采购价格"},{default:n(()=>{var t;return[s(u((t=a.value)==null?void 0:t.purchasingPrice),1)]}),_:1}),e(r,{span:2,label:"支付金额"},{default:n(()=>{var t;return[s(u((t=a.value)==null?void 0:t.paid),1)]}),_:1}),e(r,{span:2,label:"存放位置"},{default:n(()=>{var t;return[s(u((t=a.value)==null?void 0:t.storageAddress),1)]}),_:1})]),_:1})]),_:1},8,["show"])}}}),ie=[{key:"name",title:"商品名称",align:"center",render:p=>P(L,{},{default:()=>{var i;return(i=p.product)==null?void 0:i.name}})},{key:"lotNo",title:"批次号",align:"center"},{key:"count",title:"数量",align:"center"},{key:"purchasingPrice",title:"采购价格",align:"center",render:p=>P(L,{},{default:()=>`€${p.purchasingPrice}`})},{key:"paid",title:"已支付",align:"center",render:p=>P(L,{},{default:()=>`€${p.paid}`})},{key:"purchasingDate",title:"采购日期",align:"center"},{key:"storageAddress",title:"存放位置",align:"center"}],de=k({__name:"index",props:{productLots:null},setup(p){const i=p,d=N(i.productLots||[]);C(()=>i.productLots,m=>{m&&(d.value=JSON.parse(JSON.stringify(i.productLots)))});const w=[{key:"actions",title:"操作",align:"center",render:m=>e(J,{justify:"center"},{default:()=>[e(B,{size:"small",onClick:()=>r(m.id)},{default:()=>[s("详情")]})]})}],a=N({}),{bool:c,setTrue:v}=X();function r(m){const f=d.value.find(t=>t.id===m);f&&(a.value=f,v())}return(m,f)=>(D(),G(H,null,[e(oe,{ref:"listTable",columns:y(ie),"action-columns":w,data:d.value,"init-load":!1,"disable-header":!0},null,8,["columns","data"]),e(pe,{visible:y(c),"onUpdate:visible":f[0]||(f[0]=t=>U(c)?c.value=t:null),"product-lot":a.value},null,8,["visible","product-lot"])],64))}}),ze=k({__name:"index",setup(p){const{routerPush:i}=K();function d(){i({name:Z("warehouse_supplier")})}const w=Q(),a=N({}),c=$(()=>{var t,l;return Y((t=a.value)==null?void 0:t.createdAt)?ae((l=a.value)==null?void 0:l.createdAt):""}),v=new ne;function r(t,l){const b=a.value[t];z(a.value,t,l),v.updateProp({key:t,oldValue:b,newValue:l,propOptions:ue})}async function m(){var l,b;const{error:t}=await S.update(a.value.id,v.generateChangedRecord());t?(l=window.$message)==null||l.error(`操作失败! ${t.msg}`):((b=window.$message)==null||b.success("修改成功!"),setTimeout(()=>{ee().reloadPage()},500))}async function f(){var b;const t=(b=w.query)==null?void 0:b.id,{data:l}=await S.get(t);l&&(a.value=JSON.parse(JSON.stringify(l)))}return f(),(t,l)=>{const b=M,R=J,g=T,x=le,V=I,j=se,F=re,q=te;return D(),O(q,{bordered:!1,class:"h-full rounded-16px shadow-sm"},{default:n(()=>[e(R,{class:"pb-12px",justify:"space-between"},{default:n(()=>[e(y(B),{onClick:d},{icon:n(()=>[e(b)]),default:n(()=>[s("返回 ")]),_:1}),e(E,{class:"max-w-500px",data:y(v).changedData.value,onPositiveClick:m},null,8,["data"])]),_:1}),e(V,{columns:6,"label-placement":"left",class:"text-center",bordered:""},{default:n(()=>[e(g,{span:2,label:"名称"},{default:n(()=>{var o;return[s(u((o=a.value)==null?void 0:o.name),1)]}),_:1}),e(g,{span:2,label:"联系方式"},{default:n(()=>{var o;return[e(h,{"edit-component":"NInput",data:(o=a.value)==null?void 0:o.phone,"onUpdate:data":l[0]||(l[0]=_=>r("phone",_))},null,8,["data"])]}),_:1}),e(g,{span:2,label:"地址"},{default:n(()=>{var o;return[e(h,{data:(o=a.value)==null?void 0:o.address,"onUpdate:data":l[1]||(l[1]=_=>r("address",_))},null,8,["data"])]}),_:1}),e(g,{span:2,label:"支付/总额"},{default:n(()=>[e(x,{type:"primary"},{default:n(()=>{var o;return[s(" €"+u((o=a.value)==null?void 0:o.totalPrice),1)]}),_:1}),s("/ "),e(x,{type:"success"},{default:n(()=>{var o;return[s(" €"+u((o=a.value)==null?void 0:o.totalPaid),1)]}),_:1})]),_:1}),e(g,{span:2,label:"状态"},{default:n(()=>{var o;return[e(x,{type:y(A)[((o=a.value)==null?void 0:o.status)||"1"].type},{default:n(()=>{var _;return[s(u(y(A)[((_=a.value)==null?void 0:_.status)||"1"].label),1)]}),_:1},8,["type"])]}),_:1}),e(g,{span:2,label:"创建时间"},{default:n(()=>[s(u(y(c)),1)]),_:1}),e(g,{span:6,label:"发票信息","content-style":{textAlign:"left",whiteSpace:"pre-wrap"}},{default:n(()=>{var o;return[e(h,{"edit-component":"NInput","edit-component-props":{type:"textarea"},data:(o=a.value)==null?void 0:o.invoiceInfo,"onUpdate:data":l[2]||(l[2]=_=>r("invoiceInfo",_))},null,8,["data"])]}),_:1}),e(g,{span:6,label:"备注信息"},{default:n(()=>{var o;return[e(h,{data:(o=a.value)==null?void 0:o.comment,"onUpdate:data":l[3]||(l[3]=_=>r("comment",_))},null,8,["data"])]}),_:1})]),_:1}),e(F,{type:"line",animated:""},{default:n(()=>[e(j,{name:"lot",tab:"商品批次"},{default:n(()=>[e(de,{"product-lots":a.value.productLots||[]},null,8,["product-lots"])]),_:1})]),_:1})]),_:1})}}});export{ze as default};
