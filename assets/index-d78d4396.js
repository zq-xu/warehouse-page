import{_ as q}from"./export-d16a5a7e.js";import{_ as J}from"./round-plus-17f4e9b6.js";import{h as v,df as K,iM as W,iN as Z,d as B,c as O,as as A,av as R,aw as o,au as p,aB as e,aC as b,at as S,aE as G,ax as _,iS as H,az as T,ag as Q,ae as x,r as N,b8 as X,iU as Y,iT as ee,iO as F,aJ as te,aK as ae,aZ as le,aW as oe,bj as se,bk as ne}from"./index-226c16fc.js";import{_ as re}from"./ListTable.vue_vue_type_script_setup_true_lang-923ead03.js";import{d as ue}from"./time-bb10508c.js";import{N as $}from"./text-7f34c8da.js";import{_ as I}from"./Tag-58259951.js";import{N as de}from"./Popover-9915398a.js";import{_ as D}from"./SearchableSelect.vue_vue_type_script_setup_true_lang-a2b54539.js";import{s as ie}from"./salesman-bd65f029.js";import{d as pe}from"./deliverer-5dbfbe84.js";import{c as ce}from"./customer-391a907e.js";import{c as _e,u as y,a as me}from"./rule-0205d26b.js";import{_ as fe}from"./InputNumber-f2ab9a79.js";import{_ as z}from"./Input-4f09af90.js";import{_ as ve}from"./Table-b273e0ad.js";import{_ as ye}from"./FormItemGridItem-4cb5c7bc.js";import{_ as be}from"./Select-6d9d23aa.js";import{_ as he}from"./DatePicker-5fa74bfa.js";import{a as ge}from"./Grid-f2d45d29.js";import{N as E}from"./Space-29d90a90.js";import"./vuedraggable.umd-abc431c6.js";import"./refresh-fbdfae5c.js";import"./Checkbox-c63f0c7a.js";import"./use-merged-state-f061fd31.js";import"./use-loading-ec39d282.js";import"./DataTable-f4da4ff8.js";import"./format-length-c9d165c6.js";import"./Suffix-ed6a86a3.js";import"./Dropdown-84ed0a2b.js";import"./get-54cbc8e8.js";import"./next-frame-once-7035a838.js";import"./use-compitable-621a686c.js";import"./cssr-6b3a0ba4.js";import"./Add-5e0ddf2e.js";const ke=[{key:"id",title:"订单编号",align:"center"},{key:"name",title:"客户",align:"center",render:u=>v($,{},{default:()=>{var i;return(i=u.customer)==null?void 0:i.name}})},{title:"订单商品",key:"products",render:u=>{var h;return(h=u.products)==null?void 0:h.map(a=>v(I,{style:{marginRight:"6px"},type:"info",bordered:!1},{default:()=>a.name}))}},{key:"totalPrice",title:"支付情况",align:"center",render:u=>[v(I,{type:u.totalPaid>=u.totalPrice?"success":"error"},{default:()=>`€${u.totalPaid}`}),v($,{},{default:()=>"/"}),v(I,{type:"success"},{default:()=>`€${u.totalPrice}`})]},{key:"deliveryAt",title:"配送时间",align:"center",render:u=>v($,{},{default:()=>K(u.deliveryAt)?ue(u.deliveryAt):""})},{key:"deliveryMode",title:"配送方式",align:"center",render:u=>{const i=W[u.deliveryMode||2];return v(de,{placement:"right-end",disabled:u.deliveryMode!==1},{trigger:()=>v(I,{style:{marginRight:"6px"},type:i.type,bordered:!1},{default:()=>i.label}),default:()=>v("span",{style:{"margin-right":"5px"}},{default:()=>u.deliveryAddress})})}},{key:"status",title:"状态",align:"center",render:u=>{const i=Z[u.status||1];return v(I,{style:{marginRight:"6px"},type:i.type,bordered:!1},{default:()=>i.label})}}],Ue={customerId:_e("请输入购买人员"),phone:y,payMode:y,deliveryMode:y,deliveryAt:y,deliveryAddress:y,salesmanId:y,delivererId:y,products:y,paid:y,comment:y},Me={class:"text-center py-0"},Ie=p("th",{scope:"col",width:"30%"},"名称",-1),Pe=p("th",{scope:"col",width:"15%"},"库存/建议售价 €",-1),we=p("th",{scope:"col",width:"15%"},"数量",-1),Ae=p("th",{scope:"col",width:"15%"},"实际售价 €",-1),xe=p("th",{scope:"col",width:"15%"},"已支付 €",-1),Ce=p("th",{scope:"col",width:"20%"},"备注",-1),Ne={scope:"col",width:"5%"},$e=["name"],Be=B({name:"OrderProductForm",__name:"OrderProductForm",props:{data:{}},emits:["update:data"],setup(u,{emit:i}){const h=u,a=O({get(){return h.data},set(t){i("update:data",t)}});function g(t){a.value.splice(t,1)}function k(){a.value.push({})}return(t,U)=>{const M=x,m=I,r=fe,l=z,f=ve;return A(),R(f,{striped:""},{default:o(()=>[p("thead",null,[p("tr",Me,[Ie,Pe,we,Ae,xe,Ce,p("th",Ne,[e(M,{size:"small",class:"w-36px",onClick:k},{default:o(()=>[b("+")]),_:1})])])]),p("tbody",null,[(A(!0),S(Q,null,G(a.value,(c,s)=>(A(),S("tr",{key:c.id,name:s,class:"text-center py-0"},[p("td",null,[e(D,{value:a.value[s].id,"list-fn":_(H).list,"onUpdate:value":n=>{var C,P,w;a.value[s].id=n==null?void 0:n.value,a.value[s].stocks=(C=n==null?void 0:n.option)==null?void 0:C.stocks,a.value[s].price=(P=n==null?void 0:n.option)==null?void 0:P.price,a.value[s].finalPrice=(w=n==null?void 0:n.option)==null?void 0:w.price}},null,8,["value","list-fn","onUpdate:value"])]),p("td",null,[e(m,null,{default:o(()=>[b(T(a.value[s].stocks??0),1)]),_:2},1024),b(" / "),e(m,null,{default:o(()=>[b(T(a.value[s].price??0),1)]),_:2},1024)]),p("td",null,[e(r,{value:a.value[s].count,"onUpdate:value":n=>a.value[s].count=n,"default-value":0},null,8,["value","onUpdate:value"])]),p("td",null,[e(r,{value:a.value[s].finalPrice,"onUpdate:value":n=>a.value[s].finalPrice=n,"default-value":0},null,8,["value","onUpdate:value"])]),p("td",null,[e(r,{value:a.value[s].paid,"onUpdate:value":n=>a.value[s].paid=n,"default-value":0},null,8,["value","onUpdate:value"])]),p("td",null,[e(l,{value:a.value[s].comment,"onUpdate:value":n=>a.value[s].comment=n},null,8,["value","onUpdate:value"])]),p("td",null,[e(M,{class:"w-36px",onClick:n=>g(s)},{default:o(()=>[b("-")]),_:2},1032,["onClick"])])],8,$e))),128))])]),_:1})}}}),Re=B({__name:"index",props:{visible:{type:Boolean}},emits:["update:visible","succeed"],setup(u,{emit:i}){const h=u,a=O({get(){return h.visible},set(r){i("update:visible",r)}}),g=()=>{a.value=!1},k=N(),t=X({products:[]}),U=N();function M(r){t.customerId=r==null?void 0:r.value,t.phone=r!=null&&r.option.phone?r==null?void 0:r.option.phone:t.phone}async function m(){var l,f;t.deliveryAt=U.value,await((l=k.value)==null?void 0:l.validate()),t.payMode=Number(t.payMode),t.deliveryMode=Number(t.deliveryMode);const{error:r}=await F.create(t);r||((f=window.$message)==null||f.success("新增成功!"),g(),i("succeed"))}return(r,l)=>{const f=D,c=ye,s=z,n=be,C=he,P=ge,w=x,L=E,V=me,j=te;return A(),R(j,{show:a.value,"onUpdate:show":l[8]||(l[8]=d=>a.value=d),preset:"card",title:"新增订单",class:"w-1200px"},{default:o(()=>[e(V,{ref_key:"formRef",ref:k,"label-placement":"left","label-width":150,model:t,rules:_(Ue)},{default:o(()=>[e(P,{cols:36,"x-gap":18},{default:o(()=>[e(c,{span:12,label:"客户名称",path:"customerId"},{default:o(()=>[e(f,{value:t.customerId,"list-fn":_(ce).listBaseInfo,"onUpdate:value":M},null,8,["value","list-fn"])]),_:1}),e(c,{span:12,label:"联系方式",path:"phone"},{default:o(()=>[e(s,{value:t.phone,"onUpdate:value":l[0]||(l[0]=d=>t.phone=d),clearable:""},null,8,["value"])]),_:1}),e(c,{span:12,label:"支付方式",path:"payMode"},{default:o(()=>[e(n,{value:t.payMode,"onUpdate:value":l[1]||(l[1]=d=>t.payMode=d),clearable:"",options:_(Y)},null,8,["value","options"])]),_:1}),e(c,{span:12,label:"配送方式",path:"deliveryMode"},{default:o(()=>[e(n,{value:t.deliveryMode,"onUpdate:value":l[2]||(l[2]=d=>t.deliveryMode=d),clearable:"",options:_(ee)},null,8,["value","options"])]),_:1}),e(c,{span:12,label:"配送时间",path:"deliveryAt"},{default:o(()=>[e(C,{value:U.value,"onUpdate:value":l[3]||(l[3]=d=>U.value=d),clearable:""},null,8,["value"])]),_:1}),e(c,{span:12,label:"配送地址",path:"deliveryAddress"},{default:o(()=>[e(s,{value:t.deliveryAddress,"onUpdate:value":l[4]||(l[4]=d=>t.deliveryAddress=d),clearable:""},null,8,["value"])]),_:1}),e(c,{span:12,label:"销售人员",path:"salesmanId"},{default:o(()=>[e(f,{value:t.salesmanId,"list-fn":_(ie).listBaseInfo,"onUpdate:value":l[5]||(l[5]=d=>t.salesmanId=d==null?void 0:d.value)},null,8,["value","list-fn"])]),_:1}),e(c,{span:12,label:"配送人员",path:"delivererId"},{default:o(()=>[e(f,{value:t.delivererId,"list-fn":_(pe).listBaseInfo,"onUpdate:value":l[6]||(l[6]=d=>t.delivererId=d==null?void 0:d.value)},null,8,["value","list-fn"])]),_:1})]),_:1}),e(P,{cols:36,"x-gap":18},{default:o(()=>[e(c,{span:36,label:"购买商品",path:"saler"},{default:o(()=>[e(Be,{data:t.products,"onUpdate:data":l[7]||(l[7]=d=>t.products=d)},null,8,["data"])]),_:1})]),_:1}),e(L,{class:"w-full pt-16px",size:24,justify:"end"},{default:o(()=>[e(w,{class:"w-72px",onClick:g},{default:o(()=>[b("取消")]),_:1}),e(w,{class:"w-72px",type:"primary",onClick:m},{default:o(()=>[b("确定")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show"])}}}),ft=B({__name:"index",setup(u){const{bool:i,setTrue:h}=ae(),a=N(),g=N([]),k=()=>{var m;return(m=a.value)==null?void 0:m.loadTableData()},t=[{key:"actions",title:"操作",align:"center",render:m=>e(E,{justify:"center"},{default:()=>[e(x,{size:"small",onClick:()=>M(m.id)},{default:()=>[b("详情")]})]})}],{routerPush:U}=le();function M(m){U({name:se("warehouse_order-detail"),query:{id:m}})}return(m,r)=>{const l=J,f=q,c=ne;return A(),R(c,{bordered:!1,class:"rounded-16px shadow-sm"},{default:o(()=>[e(re,{ref_key:"listTable",ref:a,data:g.value,"onUpdate:data":r[0]||(r[0]=s=>g.value=s),columns:_(ke),"action-columns":t,"load-data":_(F).list},{default:o(()=>[e(_(x),{type:"primary",onClick:_(h)},{default:o(()=>[e(l,{class:"mr-4px text-20px"}),b(" 新增 ")]),_:1},8,["onClick"]),e(_(x),{type:"success"},{default:o(()=>[e(f,{class:"mr-4px text-20px"}),b(" 导出Excel ")]),_:1})]),_:1},8,["data","columns","load-data"]),e(Re,{visible:_(i),"onUpdate:visible":r[1]||(r[1]=s=>oe(i)?i.value=s:null),onSucceed:k},null,8,["visible"])]),_:1})}}});export{ft as default};
