import{d as D,c as k,r as w,w as A,as as L,av as $,aw as n,aB as e,aC as p,az as i,aJ as V,h as N,aK as R,at as j,ax as g,aW as z,ag as E,ae as F,aY as q,ao as K,bk as M,df as W}from"./index-226c16fc.js";import{_ as Y,a as G,b as y,s as H}from"./index.vue_vue_type_script_setup_true_lang-d9b3a6a5.js";import{d as Q}from"./time-bb10508c.js";import{C as X}from"./difference-6562572a.js";import{s as P}from"./supplier-d23ee9cd.js";import{_ as Z}from"./ListTable.vue_vue_type_script_setup_true_lang-923ead03.js";import{_ as C,a as B}from"./DescriptionsItem-cc739a29.js";import{N as h}from"./text-7f34c8da.js";import{N as O}from"./Space-29d90a90.js";import{_ as ee}from"./Tag-58259951.js";import{_ as te,a as ae}from"./Tabs-f3270a1d.js";import"./SearchableSelect.vue_vue_type_script_setup_true_lang-a2b54539.js";import"./Select-6d9d23aa.js";import"./use-merged-state-f061fd31.js";import"./Suffix-ed6a86a3.js";import"./use-compitable-621a686c.js";import"./cssr-6b3a0ba4.js";import"./Popover-9915398a.js";import"./get-54cbc8e8.js";import"./format-length-c9d165c6.js";import"./next-frame-once-7035a838.js";import"./DatePicker-5fa74bfa.js";import"./Dropdown-84ed0a2b.js";import"./DataTable-f4da4ff8.js";import"./Checkbox-c63f0c7a.js";import"./Input-4f09af90.js";import"./InputNumber-f2ab9a79.js";import"./Add-5e0ddf2e.js";import"./Switch-4f2d4f9f.js";import"./Popconfirm-883b60ad.js";import"./vuedraggable.umd-abc431c6.js";import"./refresh-fbdfae5c.js";import"./use-loading-ec39d282.js";const S={1:{label:"正常",type:"success"},2:{label:"异常",type:"error"},3:{label:"已删除",type:"default"}},oe=[{label:"名称",value:"name"},{label:"联系方式",value:"phone"},{label:"常用地址",value:"address"},{label:"创建时间",value:"createdAt"},{label:"更新时间",value:"updatedAt"},{label:"备注信息",value:"comment"}],ne=D({__name:"ProductLotDetail",props:{visible:{type:Boolean},productLot:{}},emits:["update:visible","updateSucceed"],setup(c,{emit:m}){const o=c,b=k({get(){return o.visible},set(u){m("update:visible",u)}}),r=w(o.productLot);return A(()=>o.productLot,u=>{u&&(r.value=JSON.parse(JSON.stringify(o.productLot)))}),(u,v)=>{const d=C,s=B,t=V;return L(),$(t,{show:b.value,"onUpdate:show":v[0]||(v[0]=a=>b.value=a),preset:"card",title:"商品批次",class:"w-600px"},{default:n(()=>[e(s,{columns:2,"label-placement":"left",class:"text-center",bordered:""},{default:n(()=>[e(d,{span:2,label:"名称"},{default:n(()=>{var a;return[p(i((a=r.value.product)==null?void 0:a.name),1)]}),_:1}),e(d,{span:2,label:"批次号"},{default:n(()=>[p(i(r.value.lotNo),1)]),_:1}),e(d,{span:2,label:"数量"},{default:n(()=>[p(i(r.value.count),1)]),_:1}),e(d,{span:2,label:"创建时间"},{default:n(()=>[p(i(r.value.createdAt),1)]),_:1}),e(d,{span:2,label:"采购价格"},{default:n(()=>{var a;return[p(i((a=r.value)==null?void 0:a.purchasingPrice),1)]}),_:1}),e(d,{span:2,label:"支付金额"},{default:n(()=>{var a;return[p(i((a=r.value)==null?void 0:a.paid),1)]}),_:1}),e(d,{span:2,label:"存放位置"},{default:n(()=>{var a;return[p(i((a=r.value)==null?void 0:a.storageAddress),1)]}),_:1})]),_:1})]),_:1},8,["show"])}}}),le=[{key:"name",title:"商品名称",align:"center",render:c=>N(h,{},{default:()=>{var m;return(m=c.product)==null?void 0:m.name}})},{key:"lotNo",title:"批次号",align:"center"},{key:"count",title:"数量",align:"center"},{key:"purchasingPrice",title:"采购价格",align:"center",render:c=>N(h,{},{default:()=>`€${c.purchasingPrice}`})},{key:"paid",title:"已支付",align:"center",render:c=>N(h,{},{default:()=>`€${c.paid}`})},{key:"purchasingDate",title:"采购日期",align:"center"},{key:"storageAddress",title:"存放位置",align:"center"}],se=D({__name:"index",props:{productLots:{}},setup(c){const m=c,o=w(m.productLots||[]);A(()=>m.productLots,s=>{s&&(o.value=JSON.parse(JSON.stringify(m.productLots)))});const b=[{key:"actions",title:"操作",align:"center",render:s=>e(O,{justify:"center"},{default:()=>[e(F,{size:"small",onClick:()=>d(s.id)},{default:()=>[p("详情")]})]})}],r=w({}),{bool:u,setTrue:v}=R();function d(s){const t=o.value.find(a=>a.id===s);t&&(r.value=t,v())}return(s,t)=>(L(),j(E,null,[e(Z,{ref:"listTable",columns:g(le),"action-columns":b,data:o.value,"init-load":!1,"disable-header":!0},null,8,["columns","data"]),e(ne,{visible:g(u),"onUpdate:visible":t[0]||(t[0]=a=>z(u)?u.value=a:null),"product-lot":r.value},null,8,["visible","product-lot"])],64))}}),je=D({__name:"index",setup(c){const m=q(),o=w({}),b=k(()=>{var s,t;return W((s=o.value)==null?void 0:s.createdAt)?Q((t=o.value)==null?void 0:t.createdAt):""}),r=new X;function u(s,t){const a=o.value[s];H(o.value,s,t),r.updateProp({key:s,oldValue:a,newValue:t,propOptions:oe})}async function v(){var t,a;const{error:s}=await P.update(o.value.id,r.generateChangedRecord());s?(t=window.$message)==null||t.error(`操作失败! ${s.msg}`):((a=window.$message)==null||a.success("修改成功!"),setTimeout(()=>{K().reloadPage()},500))}async function d(){var a;const s=(a=m.query)==null?void 0:a.id,{data:t}=await P.get(s);t&&(o.value=JSON.parse(JSON.stringify(t)))}return d(),(s,t)=>{const a=O,f=C,x=ee,J=B,U=te,I=ae,T=M;return L(),$(T,{bordered:!1,class:"h-full rounded-16px shadow-sm"},{default:n(()=>[e(a,{class:"pb-12px",justify:"space-between"},{default:n(()=>[e(Y,{"last-path":"warehouse_supplier"}),e(G,{class:"max-w-500px",data:g(r).changedData.value,onPositiveClick:v},null,8,["data"])]),_:1}),e(J,{columns:6,"label-placement":"left",class:"text-center",bordered:""},{default:n(()=>[e(f,{span:2,label:"名称"},{default:n(()=>{var l;return[p(i((l=o.value)==null?void 0:l.name),1)]}),_:1}),e(f,{span:2,label:"联系方式"},{default:n(()=>{var l;return[e(y,{"edit-component":"NInput",data:(l=o.value)==null?void 0:l.phone,"onUpdate:data":t[0]||(t[0]=_=>u("phone",_))},null,8,["data"])]}),_:1}),e(f,{span:2,label:"地址"},{default:n(()=>{var l;return[e(y,{data:(l=o.value)==null?void 0:l.address,"onUpdate:data":t[1]||(t[1]=_=>u("address",_))},null,8,["data"])]}),_:1}),e(f,{span:2,label:"支付/总额"},{default:n(()=>[e(x,{type:"primary"},{default:n(()=>{var l;return[p("€"+i((l=o.value)==null?void 0:l.totalPrice),1)]}),_:1}),p(" / "),e(x,{type:"success"},{default:n(()=>{var l;return[p("€"+i((l=o.value)==null?void 0:l.totalPaid),1)]}),_:1})]),_:1}),e(f,{span:2,label:"状态"},{default:n(()=>{var l;return[e(x,{type:g(S)[((l=o.value)==null?void 0:l.status)||"1"].type},{default:n(()=>{var _;return[p(i(g(S)[((_=o.value)==null?void 0:_.status)||"1"].label),1)]}),_:1},8,["type"])]}),_:1}),e(f,{span:2,label:"创建时间"},{default:n(()=>[p(i(b.value),1)]),_:1}),e(f,{span:6,label:"发票信息","content-style":{textAlign:"left",whiteSpace:"pre-wrap"}},{default:n(()=>{var l;return[e(y,{"edit-component":"NInput","edit-component-props":{type:"textarea"},data:(l=o.value)==null?void 0:l.invoiceInfo,"onUpdate:data":t[2]||(t[2]=_=>u("invoiceInfo",_))},null,8,["data"])]}),_:1}),e(f,{span:6,label:"备注信息"},{default:n(()=>{var l;return[e(y,{data:(l=o.value)==null?void 0:l.comment,"onUpdate:data":t[3]||(t[3]=_=>u("comment",_))},null,8,["data"])]}),_:1})]),_:1}),e(I,{type:"line",animated:""},{default:n(()=>[e(U,{name:"lot",tab:"商品批次"},{default:n(()=>[e(se,{"product-lots":o.value.productLots||[]},null,8,["product-lots"])]),_:1})]),_:1})]),_:1})}}});export{je as default};
